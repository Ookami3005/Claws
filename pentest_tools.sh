#!/usr/bin/bash
# Script que automatiza la instalación de las herramientas
# que más utilizo en el Hacking Fight Club

# -------
# Imports
# -------

# shellcheck source=pentest/build_john.sh
source pentest/build_john.sh

# shellcheck source=pentest/setup_sqlmap.sh
source pentest/setup_sqlmap.sh

# ------
# Params
# ------

# Indicamos que se espera una instrucción
if [[ $# -ne 1 ]] ; then
    echo "Error: No se recibio una instrucción"
    exit 1
fi

# Revisamos la instrucción dada es válida
if [[ $1 != "install" ]] && [[ $1 != "remove" ]] ; then
    echo "Error: Argumento incorrecto"
    exit 1
fi

# --------
# Main
# --------

pac_man=""

# Definimos a Nala como herramienta predeterminada para instalar los paquetes
command -v nala > /dev/null && pac_man=nala || pac_man=apt

# Herramientas principales en los repositorios oficiales
tools=(john nmap ffuf hydra gobuster)

# Instalamos las herramientas principales del repositorio
sudo $pac_man "$1" -y "${tools[@]}"

if [[ $1 = "install" ]]; then

    # Configuramos sqlmap
    setup_sqlmap

    echo -e "\n"

    # Compilamos scripts adicionales de John
    build_john "$(mktemp -d)"

else

    # Destruimos los Scripts auxiliares de John
    sudo rm -rf "${HOME}/.local/bin/2john"

    # Destruimos el directorio y el enlace simbólico de sqlmap
    sudo rm -rf "${HOME}/.local/bin/sqlmap-dev"
    sudo rm /usr/local/bin/sqlmap

    echo "Listo!"
fi